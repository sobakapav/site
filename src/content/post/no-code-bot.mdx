---
publishDate: 2020-06-18T00:00:00Z
title: Бот в инструментах no code. Детали реализации
excerpt: Продолжаем экспериментировать с парадигмой no code (и отчасти low code). Собрали чатбота, помогающего дочитывать большие архивы статей. В статье расскажем, какие инструменты взяли и на какие их ограничения наткнулись.
description: Собрали чатбота, помогающего дочитывать большие архивы статей. Рассказываем, какие инструменты взяли и на какие ограничения наткнулись.
author: Ольга Павлова
image: ~/assets/images/articles/no-code-bot/main.jpg
imageAlt: Бот в инструментах no code
topic: ТЕХНОЛОГИИ
tags:
  - технологии
  - практика
seeMore: |
  ### Вам нужен интерфейс?
  #### Заказать дизайн
  Напишите нам на&nbsp;[we@sobakapav.ru](mailto:we@sobakapav.ru)
  #### Что мы можем сделать?
  Что угодно от [исследования пользователей](/services/research) до [дизайна интерфейса под ключ](/services/turnkey). 
  #### Примеры из практики
  Мы наверняка уже делали интерфейс, пожожий на тот, который вам нужен. [Проверьте](https://sobakapav.ru/portfolio).
relatedLinks:
  title: Примеры работ
  links:
    - pangeo
    - e-gorod-mobile
    - alfastrah-design
    - qiwi
    - anggell
    - data-solution
    - ohlebe
    - itmo
metadata:
  canonical: https://sobakapav.ru/publications/no-code-bot
---

import DListItem from '~/components/ui/DListItem.astro';
import ToggleTheme from '~/components/common/ToggleTheme.astro';

![Чатбот, помогающий дочитывать большие архивы статей | SobakaPav.ru](~/assets/images/articles/no-code-bot/1.png)
_Каждый день бот скидывает ссылку на случайную статью из архива и просит ее оценить._

Материал для статьи и проект собраны вместе с нашим аккаунт-менеджером Романом Небылем.

#### Disclaimer. Да, нам тоже проще написать чистым кодом. Но суть nocode-упражнения именно в том, чтобы собирать полезные сервисы из готовых инструментов. Начали давно, продолжаем, нравится. Постепенно обо всём расскажем.

### Что хотели сделать

Хотели помочь людям (и себе)

- приучить читать на английском;
- уходить на обед: «Вот статья, почитаешь за столом».

Делать такой микропродукт решили через Telegram-бота:

1. **Раз в день присылает ссылку на статью из архива.** Для пробы раздербанили архив статей про дизайн [ReadingDesign](https://www.readingdesign.org/). Будет ещё.
2. **Спрашивает читателя, понравилась статья или нет.** Результаты складываем, копим данные, потом сможем найти самые интересные статьи и оценить активность пользователей.

Бота можно щупать: [@bracho_read_bot](https://teleg.run/bracho_read_bot)

Баги есть. Идеи по фичам тоже есть. И план нового релиза есть.
Короче, всё есть, но много — не мало, так что кидайте и свои мысли.

### Что использовали

[Chatforma](https://www.chatforma.com/). Один из многих (выбирали) конструкторов для чатов. Не идеальный, но хоть как-то делает что нужно. О выборе ниже.

[Integromat](https://www.integromat.com/). Передаёт данные туда-сюда по правилам и с условиями. Выбор по умолчанию для no code проектов.

[Airtable](https://airtable.com/). База данных с продвинутым интерфейсом и хорошей интеграцией с другими инструментами. Тоже выбор по умолчанию (а ещё мы её давно используем в автоматизации своих бизнес-процессов, но это другой разговор).

### Детали по инструментам

### Bot Father

Для начала нам нужен сам бот, точнее «аккаунт» для него в Telegram. Самый простой способ – найти Отца Ботов ([@BotFather](https://teleg.run/BotFather)) в Телеграм и в нем зарегистировать нового бота. Пошаговое описание гуглится на любой вкус, если в двух словах: придумываем имя бота, его логин и все. После успеха вам придет токен (ключ для идентификации и связи бота с внешним миром), который и был нам нужен на этом этапе.

### Chatforma

В сети есть куча сервисов для создания простеньких ботов для социальных сетей. Но у них у всех есть родовая травма: они созданы для воронок продаж. А потому простые и тупые.

Самый распространенный паттерн: пришел покупатель, с ним поздоровались, спросили, что нужно, облизали и начали навязчиво рассылать спам. Все это делается с помощью простых текстовых развилок и интеграции данных (например, с Битрикс24). Никакого интерактива.

Конечно, есть и решения вроде [DialogFlow](https://dialogflow.com/) на Google Cloud, но чем в них разобраться, проще написать все ручками. Поэтому берем вариант попроще.

Взяли [Chatforma](https://www.chatforma.com/). Из всего не такого уж многообразия у него у одного есть хоть какое-то API и поддержка Webhook. А раз так, то мы сможем доверить чатбот-платформе функцию непосредственно отправки, а логику настроить где-то в другом месте.

Да, предыдущий no code проект мы делали на [AIMyLogic](https://aimylogic.com/). К сожалению, интеграция с внешними сервисами у него устроена на ноль с плюсом. Так что увы, не в этот раз.

### Airtable

Место, где можно хранить данные. В нашем случае это и архив статей, которые отправляет бот, и список пользователей (мы очень любопытны и хотим знать ваши имена), и турнирную таблицу с баллами за прочитанные статьи.

Да, можно было и в Google Таблицах (на них мы уже сделали и эксплуатируем коммерческий no code проект, внезапно это [дизайн-задачник](https://www.eduhund.ru/)). И в SQL можно было. И много где еще.

Причин выбора [Airtable](https://airtable.com/) две: он приятный на мордочку и замечательно интегрируется со всем и вся. Получаешь токен API прямо в приложении и гоняешь данные в обе стороны как хочешь и где хочешь. Легко и приятно. А мы хотели, чтобы легко и приятно хоть где-нибудь и в чём-нибудь.

### Integromat

И, наконец, мозги. Сложно назвать преимущества перед тем же [Zapier](https://zapier.com/), тут чистая вкусовщина. Мы уже использовали [Integromat](https://www.integromat.com/) в предыдущих проектах, он как-то привычнее. Кстати, собирали список статей из архива мы тоже с помощью него.

### Немного суровой коммерции

Все инструменты — разной степени платности. Нас не парят микроплатежи в пределах 1000 рублей в месяц. В конце концов, для [нашей мегакорпорации](https://www.sobakapav.ru/) это посильные деньги. Но да, если для вас бесплатность инструментов — это дело принципа, то в no code игрушки лучше не играть, там почти за всё приходится отстёгивать копеечку.

### Как мы это сделали

### Базовые настройки

Задача №0 – в Chatforma завести нового бота, чтобы он просто был. Регистрируемся на платформе, радуемся, что у нас всего 14 бесплатных дней. Заходим во вкладку боты и находим заветную кнопку «Добавить бота». Называем его (имя только для Chatforma, сам бот уже назван) и выбираем соцсеть (Telegram).

После этого сразу идем в нового бота и в разделе настройки прописываем тот самый токен, который дал нам Отец Ботов, без этого ничего работать не будет.

![Настройка для токена | SobakaPav.ru](~/assets/images/articles/no-code-bot/2.png)
_Настройка для токена спрятана хорошо, надо еще поискать_

Первое, что должен сделать уважающий себя ботостроитель – научить бота здороваться. Все просто: идем в Конструктор и видим два заготовленных сообщения: стартовое и по умолчанию. В чем разница: первое – это сообщение придет, если вы только запустили бота (нажали «Старт»). Второе – это универсальная заглушка на любое сообщение, которое бот не понимает.

![Возможность добавить инлайн-клавиатуру | SobakaPav.ru](~/assets/images/articles/no-code-bot/3.png)
_А еще там можно добавлять инлайн-клавиатуру, но это уже совсем баловство_

### Собираем пользователей

Для учёта статистики и раздачи уникальных ссылок каждому нам понадобится список пользователей, запустивших бота. Он есть в разделе «Пользователи», но практической пользы не несет никакой, кроме возбуждения эго количеством подписавшихся.

![Список пользователей, запустивших бота | SobakaPav.ru](~/assets/images/articles/no-code-bot/4.png)
_По шапке таблицы можете легко определить ее полезность_

Нам пригодится Integromat, Airtable и API запрос. В Integromat этим запросом вытаскиваем список пользователей и записываем в нужную таблицу в Airtable. Чтобы не плодить дубли, перед записью проверяем на наличие пользователя в таблице по ID. Если такой уже есть — отсеиваем, остальных записываем.

![Integromat | SobakaPav.ru](~/assets/images/articles/no-code-bot/5.png)
_Отдельный фетиш в Integromat – пытаться там все выровнять_

### Настраиваем рассылку

Дальше интереснее. Нам нужно каждый день генерировать рассылку по всем участникам, вставляя туда рандомную ссылку из Airtable. А еще лучше – рандомную ссылку каждому. А еще лучше – что-нибудь написать перед ней. Что-то персональное и не повторяющееся каждый день. Идем в раздел «Рассылки» в надежде воплотить задуманное… Все очень плохо.

![Настраиваем рассылку | SobakaPav.ru](~/assets/images/articles/no-code-bot/6.png)
_Сейчас объясним, почему_

Дело вот в чём. Chatforma умеет создавать два вида рассылок: обычные и авторассылки. Первые подойдут, если нужно единоразово отправить всем (или некоторым) участникам определенный текст, картинку, опрос и так далее. Второй позволяет настроить рассылку по расписанию и дням недели, но функционал отправки ограничен только текстом и медиа, опросы так отправлять нельзя.

![Просто рассылка | SobakaPav.ru](~/assets/images/articles/no-code-bot/7.png)
_Просто рассылка_

![Авторассылка | SobakaPav.ru](~/assets/images/articles/no-code-bot/8.png)
_Авторассылка_

Вернемся к рассылке. То, что предлагает платформа, нам не подходит. Мы не можем сделать персонализированную рассылку и динамически вставлять туда любую информацию. Только заранее заготовленную. А ручками это делать не хочется. Когда у бота два пользователя, это еще ничего, но если их уже три… Поэтому решаем проблему с помощью Integromat.

Создаем сценарий со следующей логикой: Получаем список статей из Airtable – Оттуда же берем список пользователей, который мы занесли туда ранее – Каждый пользователь проходит итерацию, где генерируется рандомное число и статья под таким номером строки отправляется через POST-запрос в Chatforma. Для этого пришлось залезть в документацию к API и найти там нужный метод.

Чтобы пользователю дважды не приходила та же ссылка, подгружаем базу с уже отправленными ссылками, сортируем ее по пользователю и проверяем ссылки на соответствие. Если такая ссылка была – возвращаем на предыдущий этап и повторяем заново, если такой ссылки не было — отправляем пользователю и заносим в таблицу с отправленными.

Еще нам нужно имитировать интерактив с сообщениями, предшествующими ссылке. Добавляем в базу варианты сообщений и формируем итоговое, используя имя пользователя в телеграмме, рандомную фразу и рандомную ссылку.

![Вариация на тему бизнес-логики | SobakaPav.ru](~/assets/images/articles/no-code-bot/9.png)
_Вариация на тему бизнес-логики_

Вот что после этого происходит на стороне Chatforma. Когда Integromat отправил сообщение, Chatforma его получает и формирует единичную рассылку для конкретного пользователя. В тексте все тоже, что сформировал Integromat. Вроде работает.

Тут же обнаружилась проблема: мало того, что есть задержка при получении данных извне, так еще и Chatforma долго (до 15 минут) проводит уже сформированные рассылки. Получается, что десятичасовая рассылка может прийти и в 10:01 и в 10:16, Техподдержка этот феномен изучала 4 дня — и без особых успехов.

![Поддержка Chatforma | SobakaPav.ru](~/assets/images/articles/no-code-bot/10.png)
_Но поддержка отзывчивая, и это приятно_

### Голосовалка

Ссылку все получили, кто-то даже прочитал содержимое. Теперь нужно эту статью оценить. У API Chatforma есть два ограничения, которые не дают нам простора для творчества: мы можем в сторонние сервисы отправлять только ответы, полученные из такой сущности, как «Опрос». По API мы можем возвращать только текст, нужный нам опрос мы можем создать только внутри Chatforma, а значит можем пользоваться только теми видами рассылки, который описали ранее.

В итоге сделали следующее: расплодили опросы о качестве статьи на каждый день для всех подписчиков, поставили его на 11:00. После того, как пользователь проголосует, результат через webhook уходит в Integromat, и на основании ответа последней присланной статье для нужного пользователя проставляются баллы. Подсчет такой: за «Огонь» +1 балл проголосовавшему и +1 балл статье, за «Не очень» -1 балл статье и +1 пользователю. За «Не читал» — ничего. Еще планировали отправлять пользователю сообщение-отбивку после голосования, но от этой идеи отказались. Потому что скорость доставки — в духе «Почты России» в её лучшие годы.

![Результат голосования через webhook уходит в Integromat | SobakaPav.ru](~/assets/images/articles/no-code-bot/11.png)
_В это голосование ЕР не вмешается_

### Итого по инструментам

### Airtable

Никаких проблем при интеграции, записи и получении данных.

### Integromat

Сервис хорошо справляется с линейными операциями. Если появляется логика if/else и сравнение данных, схема получается достаточно запутанной. Но работает.

Приходится много оптимизировать процессы, так как все тарифы ограничены по количеству выполненных элементов.

### Chatforma

Сервис сырой, есть много недоработок, они злят. При этом очень хорошо организована техподдержка, она оперативная и достаточно компетентная. Большое количество инструкций и вебинаров по функционалу, они актуальные.

Найденные недостатки.

1. Ограничение видов контента в зависимости от вида рассылки.
2. Содержание рассылки, направленной через API, ограничено только текстом.
3. Webhook умеет отправлять только результаты опроса, а не любые действия пользователя.
4. Большая задержка при отправке рассылок.
5. Баги с задержкой внесения изменений после сохранения.
6. Лог не хранит присланные пользователем сообщения, только ответы на опросы.
7. Заплатить за сервис — целый квест, и нужно очень хотеть, чтобы его пройти.

### Вопросы к вам

1. Бота можно щупать: [@bracho_read_bot](https://teleg.run/bracho_read_bot) — и конечно, просим репортить о багах и предлагать фичи.
2. Какие ещё архивы англоязычных статей зашить в бота? Кое-что уже отобрали, хотим ещё.
3. Продуктоведы, вы тут есть? Вам о продуктовой части no code рассказывать — или ну его и сами с усами?
4. Набор no code инструментов. Есть ли что получше для этой задачи? Конечно, в кандидатах на вылет в основном Chatforma.

Статья также опубликована на [habr.com](https://habr.com/ru/post/507190/)

